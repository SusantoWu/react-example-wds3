var sls={Util:{}};sls.Util.has_properties=function(c){for(let e in c)if(c.hasOwnProperty(e))return!0;return!1};sls.Util.number_of_properties=function(c){let e=0;for(let g in c)c.hasOwnProperty(g)&&e++;return e};
sls.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",encode:function(c){let e="",g=0;for(c=sls.Base64._utf8_encode(c);g<c.length;){var h=c.charCodeAt(g++);const n=c.charCodeAt(g++),q=c.charCodeAt(g++),t=h>>2;h=(h&3)<<4|n>>4;let a=(n&15)<<2|q>>6,b=q&63;isNaN(n)?a=b=64:isNaN(q)&&(b=64);e=e+this._keyStr.charAt(t)+this._keyStr.charAt(h)+this._keyStr.charAt(a)+this._keyStr.charAt(b)}return e},_utf8_encode:function(c){c=c.replace(/\r\n/g,"\n");let e="";for(let g=0;g<c.length;g++){const h=
c.charCodeAt(g);128>h?e+=String.fromCharCode(h):(127<h&&2048>h?e+=String.fromCharCode(h>>6|192):(e+=String.fromCharCode(h>>12|224),e+=String.fromCharCode(h>>6&63|128)),e+=String.fromCharCode(h&63|128))}return e},_utf8_encode_length:function(c){c=c.replace(/\r\n/g,"\n");let e=0;for(let g=0;g<c.length;g++){const h=c.charCodeAt(g);128>h?e++:e=127<h&&2048>h?e+2:e+3}return e}};sls.ReturnCode={Success:0,NoConnection:1,NoService:2,NoName:3,NoFields:4,InvalidRequestType:5,UndefinedOrNullParam:6};
sls.RecFidState={OK:0,RequestPending:1,Stale:2,NotAvailable:3,RequestError:4,NotPermissioned:5,ServiceStale:6,ServiceUnknown:7,Dropped:8,RecordPaused:9,ErrorRecordPaused:10,RecordStateChangeName:20};sls.FieldStatusFlags={Partial:256,Merged:512};sls.ConnectionFlags={UseWebSockets:1,UseIntegerFields:2,LogMessages:4};sls.ConnectionStatus={Init:0,Active:1,Down:2,Reconnecting:3,Unauthorised:4,MaxClientsExceeded:5,MaxConnectAttemptsExceeded:6};
sls.RequestField=function(c){this.id=c;this.value="";this.dataLength=this.offset=0};sls.RequestType={Monitor:"M",Unmonitor:"U",Snapshot:"S"};sls.RequestFlags={NoMerge:1,WhenAvailable:2};sls.RecordRequest=function(c,e){this.service=c;this.name=e;this.type=sls.RequestType.Monitor;this.flags=this.priority=0;this.fields=[]};sls.RecordRequest.prototype.setType=function(c){this.type=c};sls.RecordRequest.prototype.setFields=function(c){for(let e=0;e<c.length;e++)this.fields.push(new sls.RequestField(c[e]))};
sls.RecordRequest.prototype.setPriority=function(c){this.priority=c};sls.RecordRequest.prototype.setNoMerge=function(){this.flags|=sls.RequestFlags.NoMerge};sls.RecordRequest.prototype.setWhenAvailable=function(){this.flags|=sls.RequestFlags.WhenAvailable};
sls.RecordRequest.prototype.serialize=function(){let c=this.service+","+this.name+","+this.type;if(0<this.flags||0<this.priority)c+=",[",0<this.flags?(c+="f"+this.flags,0<this.priority&&(c+=",p"+this.priority)):0<this.priority&&(c+="p"+this.priority),c+="]";for(const e of this.fields)c+=","+e.id;return c};sls.InsertType={Record:"R",Page:"P"};sls.InsertRequest=function(c,e,g){this.service=c;this.name=e;this.type=sls.InsertType.Record;this.seqNo=g;this.sendTime=this.flags=0;this.fields=[]};
sls.InsertRequest.prototype.setType=function(c){this.type=c};sls.InsertRequest.prototype.setField=function(c,e,g,h){c=new sls.RequestField(c);c.offset=e;!0===h&&(this.flags|=sls.RequestFlags.NoMerge);c.value=g;c.dataLength=sls.Base64._utf8_encode_length(g);this.fields.push(c)};sls.InsertRequest.prototype.serialize=function(){let c=this.service+","+this.name+","+this.type+","+this.seqNo;for(const e of this.fields)c+=","+e.id+","+e.offset+","+this.flags+","+e.dataLength+","+e.value;return c};
sls._maxConnectAttempts=0;sls._insertTimeout=1E4;sls.InsertStatusCode={Success:0,Fail:1,Timeout:2};sls.InsertStatus=function(c,e,g,h,n){this.s=c;this.k=e;this.i=g;this.n=h;this.t=n};sls.RecordField=function(c,e,g){this.i=c;this.v=e;this.f=g};sls.RecordField.prototype.updateValue=function(c,e){if(e&sls.FieldStatusFlags.Partial){var g=e&255;e=this.v.slice(0,g);g=this.v.slice(g+c.length,this.v.length);this.v=e+c+g}else this.v=c};
sls.CacheRecord=function(c,e,g,h,n){this.s=c;this.k=e;this.reqType=g;this.reqFlags=h;this.reqPrio=n||0;this.f=sls.RecFidState.OK;this.d=0;this.fids={}};sls.RecordUpdate=function(c,e){this.s=c;this.k=e;this.f=sls.RecFidState.OK;this.n=this.t="";this.d=0;this.fids=[]};sls.Callbacks;WebSocket.prototype.sslconn=null;
sls.HttpConnection=function(c,e,g,h,n,q){sls.HttpConnection.prototype.request_record=function(a){if(void 0===a.service||""===a.service)return sls.ReturnCode.NoService;if(void 0===a.name||""===a.name)return sls.ReturnCode.NoName;if(void 0===a.fields||0===a.fields.length)return sls.ReturnCode.NoFields;if(a.type===sls.RequestType.Monitor)this._requests.push(a);else if(a.type===sls.RequestType.Snapshot)this._requests.unshift(a);else return sls.ReturnCode.InvalidRequestType;return sls.ReturnCode.Success};
sls.HttpConnection.prototype.unmonitor_fields=function(a){if(void 0===a.service||""===a.service)return sls.ReturnCode.NoService;if(void 0===a.name||""===a.name)return sls.ReturnCode.NoName;if(void 0===a.fields||0===a.fields.length)return sls.ReturnCode.NoFields;a.setType(sls.RequestType.Unmonitor);this._requests.push(a);const b=a.service+a.name;if(this._pend[b]){for(var d of a.fields)this._pend[b].fids[d.id]&&delete this._pend[b].fids[d.id];d=0;for(let f in this._pend[b].fids)if(this._pend[b].fids.hasOwnProperty(f)){d=
1;break}0===d&&delete this._pend[b]}if(this._cache[b]){for(const f of a.fields)this._cache[b].fids[f.id]&&delete this._cache[b].fids[f.id];a=0;for(let f in this._cache[b].fids)if(this._cache[b].fids.hasOwnProperty(f)){a=1;break}0===a&&delete this._cache[b]}return sls.ReturnCode.Success};sls.HttpConnection.prototype.unmonitor_record=function(a){if(void 0===a.service||""===a.service)return sls.ReturnCode.NoService;if(void 0===a.name||""===a.name)return sls.ReturnCode.NoName;const b=a.service+a.name;
let d=[],f=0;if(this._pend[b]){for(let k in this._pend[b].fids)this._pend[b].fids.hasOwnProperty(k)&&(d[f++]=k);delete this._pend[b]}if(this._cache[b]){for(let k in this._cache[b].fids)this._cache[b].fids.hasOwnProperty(k)&&(d[f++]=k);delete this._cache[b]}if(0>=d.length)return sls.ReturnCode.Success;a.setType(sls.RequestType.Unmonitor);a.setFields(d);this._requests.push(a);return sls.ReturnCode.Success};sls.HttpConnection.prototype.insert_request=function(a){if(void 0===a.service||""===a.service)return sls.ReturnCode.NoService;
if(void 0===a.name||""===a.name)return sls.ReturnCode.NoName;if(void 0===a.fields||0===a.fields.length)return sls.ReturnCode.NoFields;this._inserts.push(a);return sls.ReturnCode.Success};sls.HttpConnection.prototype.destroy=function(){"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("destroy() called");clearInterval(this._runID);null!==this._websocket&&this._websocket.close();this._ctlFlags&=~this.FL_apiStarted};sls.HttpConnection.prototype.pause_updates=function(a){return(this._ctlFlags&
this.FL_connected||this._ctlFlags&this.FL_buffered)&&0!==this._sig&&0!==this._id?(this.sendPause(a),this._ctlFlags|=this.FL_paused,sls.ReturnCode.Success):sls.ReturnCode.NoConnection};sls.HttpConnection.prototype.resume_updates=function(){return(this._ctlFlags&this.FL_connected||this._ctlFlags&this.FL_buffered)&&0!==this._sig&&0!==this._id?(this.sendResume(),this._ctlFlags&=~this.FL_paused,sls.ReturnCode.Success):sls.ReturnCode.NoConnection};sls.HttpConnection.prototype.setStatus=function(a){this._statusChanged=
!0};sls.HttpConnection.prototype.getURI=function(){var a=new Date;a=""===this._auth?this._hostWDS+"/JS3/"+a.getTime()+"/SlingShot2000/index.html":this._hostWDS+"/JS3/"+a.getTime()+"/SlingShot2000/index.html?"+this._auth;var b="";this._flags&sls.ConnectionFlags.UseIntegerFields&&(b+="02\n");var d=this.serializeReqCache(this._pend);for(""!==d&&(b+=d);0<this._requests.length&&600>b.length;)d=this._requests.shift(),b+="2"+d.serialize()+"\n",this.addToReqCache(d);""!==b&&(b=sls.Base64.encode(b),1997>a.length+
b.length&&(a=a+"%23"+b));return a};sls.HttpConnection.prototype.getWsURI=function(){var a=this._hostWDS.replace(/.*?:\/\//g,"");a=this._ws+a+"/"+(new Date).getTime()+"/SlingShot2000/index.html";""!==this._identifier&&(a+="?"+this._identifier);let b="";for(this._flags&sls.ConnectionFlags.UseIntegerFields&&(b+="02\n");0<this._requests.length&&600>b.length;){const d=this._requests.shift();b+="2"+d.serialize()+"\n";this.addToReqCache(d)}""!==b&&(a=a+"%23"+sls.Base64.encode(b));return a};sls.HttpConnection.prototype.nextWsURI=
function(){this._incCnt++;return this._ws+this._host+"/CSK"+this._incCnt+"/SlingShot2000/"+this._sig+"/"+this._id};sls.HttpConnection.prototype.post=function(a){this._ctlFlags&=~this.FL_pingRequired;a=this.connHdr()+a;this._ctlFlags&this.FL_buffered&&(a+="5\n");"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("post data:\n"+a);null!==this._websocket&&this._websocket.send(a)};sls.HttpConnection.prototype.ac=function(a){this._ctlFlags&=~this.FL_recvClose;if(this._ctlFlags&this.FL_initConn){this._sig=
a.s;this._id=a.i;this._host=a.h;this._ping=a.p;this._logging=a.l;const b=this;this._connAttempts=0;setTimeout(function(){b.processConnect()},100)}else{if(this._sig!==a.s||this._id!==a.i){this._ctlFlags&=~this.FL_connected;this._ctlFlags|=this.FL_broken;this._ctlFlags&=~this.FL_buffered;this._id=this._sig=0;const b=this;setTimeout(function(){b.broken()},1E3);return}this._ctlFlags|=this.FL_connected;this._ctlFlags&=~this.FL_broken}this._actTime=this._now};sls.HttpConnection.prototype.processConnect=
function(){this._ctlFlags&this.FL_initConn&&(this._ctlFlags|=this.FL_pingRequired);this._ctlFlags&=~this.FL_initConn;this._ctlFlags&this.FL_recvClose?(this._ctlFlags|=this.FL_buffered,this._ctlFlags|=this.FL_bcRecv):this._ctlFlags|=this.FL_connected;"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("processConnect: recvClose = "+(this._ctlFlags&this.FL_recvClose)+" , buffered ="+(this._ctlFlags&this.FL_buffered));this._ctlFlags&=~this.FL_broken;this._ctlFlags&=~this.FL_staleSet;
this.setStatus("connected to Slingshot...");this.callbacks.connection_status&&this.callbacks.connection_status(sls.ConnectionStatus.Active)};sls.HttpConnection.prototype.bc=function(){this._ctlFlags|=this.FL_bcRecv};sls.HttpConnection.prototype.rc=function(){"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("push page _rc received.");this._ctlFlags&=~this.FL_connected;this._ctlFlags|=this.FL_recvClose;const a=this;setTimeout(function(){a.reconnect()},1E3);this._actTime=this._now};
sls.HttpConnection.prototype.hb=function(){this._actTime=this._now};sls.HttpConnection.prototype.pi=function(){this._actTime=this._now;this._ctlFlags|=this.FL_pingRequired};sls.HttpConnection.prototype.sendPing=function(){this.post("3\n")};sls.HttpConnection.prototype.sendPause=function(a){void 0===a?this.post("7\n"):this.post("7,"+a+"\n")};sls.HttpConnection.prototype.sendResume=function(){this.post("8\n")};sls.HttpConnection.prototype.up=function(a){this._actTime=this._now;"undefined"!==typeof this.callbacks.debug_msg&&
this.callbacks.debug_msg("Update received for "+a.s+" "+a.k);const b=a.s+a.k;if(a.f===sls.RecFidState.RecordStateChangeName)this.processNameChange(a);else{if(this.callbacks.record_update){if(void 0===a.fids||null===a.fids)a.fids=[];if(0===a.fids.length){if(null!==this._pend&&this._pend[b])var d=this._pend[b];else if(null!==this._cache&&this._cache[b])d=this._cache[b];else if(null!==this._snapCache&&this._snapCache[b])d=this._snapCache[b];else return;let m=0;for(let r in d.fids)d.fids.hasOwnProperty(r)&&
(a.fids[m]=new sls.RecordField(r,d.fids[r].v,d.fids[r].f),++m)}this.callbacks.record_update(a)}if(null!==this._snapCache){if(this._snapCache[b]){for(const m of a.fids)this._snapCache[b].fids[m.i]&&delete this._snapCache[b].fids[m.i];d=0;for(var f in this._snapCache[b].fids)if(this._snapCache[b].fids.hasOwnProperty(f)){d=1;break}0===d&&delete this._snapCache[b]}f=0;for(var k in this._snapCache)if(this._snapCache.hasOwnProperty(k)){f=1;break}0===f&&(delete this._snapCache,this._snapCache=null)}if(this._pend[b]){if(a.f===
sls.RecFidState.OK){if(void 0===this._cache[b]||null===this._cache[b])this._cache[b]=new sls.CacheRecord(a.s,a.k,this._pend[b].reqType,this._pend[b].reqFlags,this._pend[b].reqPrio);for(const m in this._pend[b].fids)!this._pend[b].fids.hasOwnProperty(m)||void 0!==this._cache[b].fids[m]&&null!==this._cache[b].fids[m]||(this._cache[b].fids[m]={})}for(const m of a.fids)this._pend[b].reqFlags&sls.RequestFlags.WhenAvailable&&a.f===sls.RecFidState.NotAvailable||!this._pend[b].fids[m.i]||delete this._pend[b].fids[m.i];
k=0;for(var p in this._pend[b].fids)if(this._pend[b].fids.hasOwnProperty(p)){k=1;break}0===k&&delete this._pend[b]}if(void 0!==this._cache[b]&&null!==this._cache[b])switch(p=null,this._cache[b].f=a.f,this._cache[b].d=a.d,a.f){case sls.RecFidState.OK:for(var l of a.fids)if(void 0===this._cache[b].fids[l.i]||null===this._cache[b].fids[l.i])null===p&&(p=[]),p.push(l.i);else if(this._cache[b].fids[l.i].f=l.f,l.f&sls.FieldStatusFlags.Partial){a=l.f&255;var u=this._cache[b].fids[l.i].v.slice(0,a);a=this._cache[b].fids[l.i].v.slice(a+
l.v.length,this._cache[b].fids[l.i].v.length);this._cache[b].fids[l.i].v=u+l.v+a}else this._cache[b].fids[l.i].v=l.v;break;case sls.RecFidState.NotAvailable:case sls.RecFidState.RequestError:case sls.RecFidState.NotPermissioned:case sls.RecFidState.ServiceUnknown:case sls.RecFidState.Dropped:for(const m of a.fids)this._cache[b].fids[m.i]&&delete this._cache[b].fids[m.i];l=0;for(u in this._cache[b].fids)if(this._cache[b].fids.hasOwnProperty(u)){l=1;break}0===l&&delete this._cache[b]}}};sls.HttpConnection.prototype.processNameChange=
function(a){const b=a.s+a.n,d=a.s+a.k;if(null!==this._snapCache&&this._snapCache[b]){this._snapCache[d]=new sls.CacheRecord(a.s,a.k,this._snapCache[b].reqType,this._snapCache[b].reqFlags,this._snapCache[b].reqPrio);for(let f in this._snapCache[b].fids)this._snapCache[b].fids.hasOwnProperty(f)&&(this._snapCache[d].fids[f]={});delete this._snapCache[b]}if(null!==this._pend&&this._pend[b]){this._pend[d]=new sls.CacheRecord(a.s,a.k,this._pend[b].reqType,this._pend[b].reqFlags,this._pend[b].reqPrio);for(let f in this._pend[b].fids)this._pend[b].fids.hasOwnProperty(f)&&
(this._pend[d].fids[f]={});delete this._pend[b]}if(null!==this._cache&&this._cache[b]){this._cache[d]=new sls.CacheRecord(a.s,a.k,this._cache[b].reqType,this._cache[b].reqFlags,this._cache[b].reqPrio);for(let f in this._cache[b].fids)this._cache[b].fids.hasOwnProperty(f)&&(this._cache[d].fids[f]={});delete this._cache[b]}this.callbacks.record_update&&this.callbacks.record_update(a)};sls.HttpConnection.prototype.ins=function(a){"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Insert status received for "+
a.s+" "+a.k+" "+a.i);const b="i"+a.i;if(!1!==this._insCache.hasOwnProperty(b)&&void 0!==this._insCache[b]&&null!==this._insCache[b]){if(this.callbacks.insert_status){let d=sls.InsertStatusCode.Fail;void 0!==a.n&&(d=a.n);a=new sls.InsertStatus(this._insCache[b].service,this._insCache[b].name,this._insCache[b].seqNo,d,a.t);this.callbacks.insert_status(a)}delete this._insCache[b]}};sls.HttpConnection.prototype.end=function(){"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("_end: _recvClose="+
(this._ctlFlags&this.FL_recvClose?"1":"0")+" _buffered="+(this._ctlFlags&this.FL_buffered?"1":"0")+" _bcRecv="+(this._ctlFlags&this.FL_bcRecv?"1":"0"));if(!(this._ctlFlags&this.FL_recvClose)){this._ctlFlags&=~this.FL_connected;this._ctlFlags|=this.FL_broken;this._ctlFlags&=~this.FL_buffered;this._id=this._sig=0;const a=this;setTimeout(function(){a.broken()},1E3)}else if(this._ctlFlags&this.FL_buffered&&!(this._ctlFlags&this.FL_bcRecv)){this._ctlFlags&=~this.FL_connected;this._ctlFlags|=this.FL_broken;
this._ctlFlags&=~this.FL_buffered;this._id=this._sig=0;const a=this;setTimeout(function(){a.broken()},1E3)}this._ctlFlags&=~this.FL_bcRecv};sls.HttpConnection.prototype.xa=function(){clearInterval(this._runID);this.callbacks.connection_status&&this.callbacks.connection_status(sls.ConnectionStatus.Unauthorised);"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Unauthorised connection");null!==this._websocket&&(this._websocket.close(),this._websocket=null);this._ctlFlags|=this.FL_unauthorised};
sls.HttpConnection.prototype.xc=function(){clearInterval(this._runID);this.callbacks.connection_status&&this.callbacks.connection_status(sls.ConnectionStatus.MaxClientsExceeded);"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Maximum clients exceeded")};sls.HttpConnection.prototype.markStale=function(){for(let a in this._cache)if(this._cache.hasOwnProperty(a)){this._cache[a].f=sls.RecFidState.ServiceStale;let b=new sls.RecordUpdate(this._cache[a].s,this._cache[a].k);b.f=this._cache[a].f;
b.d=this._cache[a].d;let d=0;for(let f in this._cache[a].fids)if(this._cache[a].fids.hasOwnProperty(f)){if(void 0===b.fids||null===b.fids)b.fids=[];b.fids[d]=new sls.RecordField(f,this._cache[a].fids[f].v,this._cache[a].fids[f].f);++d}this.callbacks.record_update(b)}};sls.HttpConnection.prototype.broken=function(){if(this._ctlFlags&this.FL_apiStarted&&!(this._ctlFlags&this.FL_connected||this._ctlFlags&this.FL_buffered)){var a=this;if(0!==sls._maxConnectAttempts&&this._connAttempts>sls._maxConnectAttempts)"undefined"!==
typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Maximum consecutive reconnect attempts ("+sls._maxConnectAttempts+") exceeded. STOPPING ..."),this.callbacks.connection_status&&this.callbacks.connection_status(sls.ConnectionStatus.MaxConnectAttemptsExceeded),clearInterval(this._runID);else{"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Connection broken.");++this._connAttempts;this._ctlFlags|=this.FL_rereq;this._ctlFlags|=this.FL_initConn;this._ctlFlags&=~this.FL_buffered;
this._ctlFlags&=~this.FL_bcRecv;this._ctlFlags&this.FL_staleSet||(this._ctlFlags|=this.FL_staleSet,this.markStale(),this.callbacks.connection_status&&this.callbacks.connection_status(sls.ConnectionStatus.Down));null!==this._websocket&&(this._websocket.close(),this._websocket=null);if(""===this._auth)this._websocket=new WebSocket(this.getWsURI());else{let b=sls.Base64.encode(this._auth);this._websocket=new WebSocket(this.getWsURI(),["slingshot.protocolv2.auth.base64."+b,"slingshot.protocolv2"])}this._websocket.onopen=
a.onopen;this._websocket.onmessage=a.onmessage;this._websocket.onclose=a.onclose;this._websocket.onerror=a.onerror;this._websocket.slsconn=this;this.setStatus("connection lost");setTimeout(function(){a.broken()},4200)}}};sls.HttpConnection.prototype.reconnect=function(){this._ctlFlags&this.FL_apiStarted&&("undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Reconnecting."),null===this._host||""===this._host?this.xa():(null!==this._websocket&&this._websocket.close(),this._websocket=
new WebSocket(this.nextWsURI()),this._websocket.onopen=this.onopen,this._websocket.onmessage=this.onmessage,this._websocket.onclose=this.onclose,this._websocket.onerror=this.onerror,this._websocket.slsconn=this))};sls.HttpConnection.prototype.sendClose=function(){0!==this._sig&&0!==this._id&&this.post("4\n")};sls.HttpConnection.prototype.connHdr=function(){return 0>=this._bandwidth?"1"+this._sig+","+this._id+","+(this._flags&sls.ConnectionFlags.UseIntegerFields)+"\n":"1"+this._sig+","+this._id+","+
(this._flags&sls.ConnectionFlags.UseIntegerFields)+","+this._bandwidth+"\n"};sls.HttpConnection.prototype.run=function(){this._now+=this._runInt;if(this._ctlFlags&this.FL_paused)this._actTime=this._now;else if((this._ctlFlags&this.FL_connected||this._ctlFlags&this.FL_buffered)&&0!==this._sig&&0!==this._id)if(!(this._ctlFlags&this.FL_broken)&&this._now>this._actTime+1E3*this._ping+3E3){"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Activity time out.");this._ctlFlags|=this.FL_broken;
this._ctlFlags&=~this.FL_connected;this._ctlFlags&=~this.FL_recvClose;this._ctlFlags&=~this.FL_buffered;const a=this;setTimeout(function(){a.broken()},4200)}else{if(!(this._ctlFlags&this.FL_rereq)&&0<this._requests.length||0<this._inserts.length)"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Sending requests."),this.sendRequests();!(this._ctlFlags&this.FL_rereq)&&this._now>this._pendCheckTime+1E4&&(this._pendCheckTime=this._now,this.requestPending(),this.checkInserts());
this._ctlFlags&this.FL_rereq&&this.reRequestAll();this._ctlFlags&this.FL_pingRequired&&this.sendPing()}else this._pendCheckTime=this._now};sls.HttpConnection.prototype.checkRequest=function(a){const b=a.service+a.name;let d=a.fields.length;if(this._pend[b])for(;d--;)this._pend[b].fids[a.fields[d].id]&&a.fields.splice(d,1);d=a.fields.length;if(this._cache[b])for(;d--;)this._cache[b].fids[a.fields[d].id]&&a.fields.splice(d,1)};sls.HttpConnection.prototype.sendRequests=function(){if(0!==this._requests.length||
0!==this._inserts.length){for(var a="";0<this._requests.length;){var b=this._requests.shift();this.checkRequest(b);0>=b.fields.length||(a+="2"+b.serialize()+"\n",this.addToReqCache(b))}if(0<this._inserts.length)for(b=(new Date).getTime();0<this._inserts.length;){let d=this._inserts.shift();a+="6"+d.serialize()+"\n";d.sendTime=b;this._insCache["i"+d.seqNo]=d}this.post(a)}};sls.HttpConnection.prototype.requestPending=function(){const a=this.serializeReqCache(this._snapCache),b=this.serializeReqCache(this._pend);
let d="";""!==b&&(d+=b);""!==a&&(d+=a);""!==d&&("undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Requesting pending."),this.post(d))};sls.HttpConnection.prototype.reRequestAll=function(){this._ctlFlags&=~this.FL_rereq;let a=this.serializeReqCache(this._snapCache),b=this.serializeReqCache(this._pend),d=this.serializeReqCache(this._cache),f="";""!==b&&(f+=b);if(""!==d){f+=d;for(let k in this._cache)if(this._cache.hasOwnProperty(k)){if(void 0===this._pend[k]||null===this._pend[k])this._pend[k]=
new sls.CacheRecord(this._cache[k].s,this._cache[k].k,this._cache[k].reqType,this._cache[k].reqFlags,this._cache[k].reqPrio);for(let p in this._cache[k].fids)!this._cache[k].fids.hasOwnProperty(p)||void 0!==this._pend[k].fids[p]&&null!==this._pend[k].fids[p]||(this._pend[k].fids[p]={});delete this._cache[k]}}""!==a&&(f+=a);""!==f&&this.post(f)};sls.HttpConnection.prototype.serializeReqCache=function(a){if(void 0===a||null===a)return"";let b="";for(const d in a)if(a.hasOwnProperty(d)){b+="2"+a[d].s+
","+a[d].k+","+a[d].reqType;if(0<a[d].reqFlags||0<a[d].reqPrio)b+=",[",0<a[d].reqFlags?(b+="f"+a[d].reqFlags,0<a[d].reqPrio&&(b+=",p"+a[d].reqPrio)):0<a[d].reqPrio&&(b+="p"+a[d].reqPrio),b+="]";for(const f in a[d].fids)a[d].fids.hasOwnProperty(f)&&(b+=","+f);b+="\n"}return b};sls.HttpConnection.prototype.addToReqCache=function(a){let b;if(a.type===sls.RequestType.Monitor)b=this._pend;else if(a.type===sls.RequestType.Snapshot){if(void 0===this._snapCache||null===this._snapCache)this._snapCache={};
b=this._snapCache}else return;const d=a.service+a.name;if(b[d]){if(void 0===b[d].fids||null===b[d].fids)b[d].fids={};for(const f of a.fields)if(void 0===b[d].fids[f.id]||null===b[d].fids[f.id])b[d].fids[f.id]={}}else{b[d]=new sls.CacheRecord(a.service,a.name,a.type,a.flags,a.priority);for(const f of a.fields)b[d].fids[f.id]={}}};sls.HttpConnection.prototype.checkInserts=function(){for(let a in this._insCache)if(this._insCache.hasOwnProperty(a)&&sls._insertTimeout+this._insCache[a].sendTime<this._now){if(this.callbacks.insert_status){let b=
new sls.InsertStatus(this._insCache[a].service,this._insCache[a].name,this._insCache[a].seqNo,sls.InsertStatusCode.Timeout,"Insert timed out");this.callbacks.insert_status(b)}delete this._insCache[a]}};sls.HttpConnection.prototype.onopen=function(a){"undefined"!==typeof this.slsconn.callbacks.debug_msg&&this.slsconn.callbacks.debug_msg("WS.onopen: WebSocket connection established.")};sls.HttpConnection.prototype.onmessage=function(a){(this.slsconn._flags&sls.ConnectionFlags.LogMessages)===sls.ConnectionFlags.LogMessages&&
console.log("WS.onmessage: data='"+a.data+"'");a=JSON.parse(a.data);if(a.hasOwnProperty("up"))for(let b=0;b<a.up.length;b++){let d=a.up[b];null!==d&&(d.hasOwnProperty("s")?this.slsconn.up(d):d.hasOwnProperty("pi")?this.slsconn.pi():d.hasOwnProperty("hb")?this.slsconn.hb():d.hasOwnProperty("ins")&&this.slsconn.ins(d.ins))}else a.hasOwnProperty("ac")?this.slsconn.ac(a.ac):a.hasOwnProperty("hb")?this.slsconn.hb():a.hasOwnProperty("rc")?this.slsconn.rc():a.hasOwnProperty("xa")?this.slsconn.xa():a.hasOwnProperty("xc")&&
this.slsconn.xc()};sls.HttpConnection.prototype.onclose=function(a){"undefined"!==typeof this.slsconn.callbacks.debug_msg&&this.slsconn.callbacks.debug_msg("WS.onclose: wasClean="+a.wasClean+", code="+a.code+", reason="+a.reason);this.slsconn._websocket=null;if(!(1006!==a.code||this.slsconn._ctlFlags&this.slsconn.FL_initConn||this.slsconn._ctlFlags&this.slsconn.FL_broken)){this.slsconn._ctlFlags|=this.slsconn.FL_broken;this.slsconn._ctlFlags&=~this.slsconn.FL_connected;this.slsconn._ctlFlags&=~this.slsconn.FL_recvClose;
this.slsconn._ctlFlags&=~this.slsconn.FL_buffered;const b=this.slsconn;setTimeout(function(){b.broken()},4200)}};sls.HttpConnection.prototype.onerror=function(a){"undefined"!==typeof this.slsconn.callbacks.debug_msg&&this.slsconn.callbacks.debug_msg("WS.onerror")};sls.HttpConnection.prototype.reset=function(){this._incCnt=this._id=this._sig=0;this._ctlFlags&=~this.FL_connected;this._ctlFlags&=~this.FL_broken;this._ctlFlags&=~this.FL_recvClose;this._ctlFlags&=~this.FL_bcRecv;this._ctlFlags|=this.FL_initConn;
this._ctlFlags&=~this.FL_buffered;this._ctlFlags|=this.FL_pingRequired;this._pendCheckTime=this._actTime=this._now=(new Date).getTime()};sls.HttpConnection.prototype.startWsAPI=function(){if(window.WebSocket){const a=this;if(""===this._auth)this._websocket=new WebSocket(this.getWsURI());else{let b=sls.Base64.encode(this._auth);this._websocket=new WebSocket(this.getWsURI(),["slingshot.protocolv2.auth.base64."+b,"slingshot.protocolv2"])}this._websocket.onopen=a.onopen;this._websocket.onmessage=a.onmessage;
this._websocket.onclose=a.onclose;this._websocket.onerror=a.onerror;this._websocket.slsconn=this;"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Initial connection attempt...");this._runID=setInterval(function(){a.run()},this._runInt);"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("Started WS API.");this.callbacks.api_started&&this.callbacks.api_started()}else"undefined"!==typeof this.callbacks.debug_msg&&this.callbacks.debug_msg("No WebSockets support.")};
this.FL_connected=1;this.FL_broken=2;this.FL_recvClose=4;this.FL_bcRecv=8;this.FL_initConn=16;this.FL_buffered=32;this.FL_rereq=64;this.FL_staleSet=128;this.FL_pingRequired=256;this.FL_unauthorised=512;this.FL_paused=1024;this.FL_apiStarted=2048;this._ctlFlags=0;this._hostWDS="";this._flags=h||0;this._host=null;this._ping=15;this._logging=0;this._statusChanged=!1;this._ws="ws://";this._pendCheckTime=this._actTime=this._now=0;this._runInt=100;this._requests=[];this._inserts=[];this._pend={};this._cache=
{};this._snapCache=null;this._insCache={};this._runID=0;this._auth=g||"";this._websocket=null;this._bandwidth=n||0;this._id=this._sig=this._incCnt=this._connAttempts=0;this._identifier=q||"";this.callbacks=e||{};this._ctlFlags|=this.FL_apiStarted;this._ctlFlags&=~this.FL_rereq;this._ctlFlags&=~this.FL_staleSet;this.reset();-1!==c.indexOf("https://")&&(this._ws="wss://");this._hostWDS=c;const t=this;setTimeout(function(){t.startWsAPI()},20)};
var _sls_theHttpConnection=null,_ac=function(c){_sls_theHttpConnection.ac(c)},_up=function(c){_sls_theHttpConnection.up(c)},_hb=function(){_sls_theHttpConnection.hb()},_pi=function(){_sls_theHttpConnection.pi()},_rc=function(){_sls_theHttpConnection.rc()},_bc=function(){_sls_theHttpConnection.bc()},_xa=function(){_sls_theHttpConnection.xa()},_xc=function(){_sls_theHttpConnection.xc()},_ins=function(c){_sls_theHttpConnection.ins(c)},_end=function(){_sls_theHttpConnection.end()};sls.get_version=function(){return"Slingshot WDS3 JavaScript Client 2.1 - Copyright valantic Transaction Solutions Gmbh 2018-2024 - $LastChangedRevision: 5318 $]"};
sls.create_http_connection=function(c,e,g,h,n,q){return null===_sls_theHttpConnection?(_sls_theHttpConnection=new sls.HttpConnection(c,e,g,h,n,q),sls.ReturnCode.Success):sls.ReturnCode.NoConnection};sls.destroy_http_connection=function(){null!==_sls_theHttpConnection&&(_sls_theHttpConnection.destroy(),_sls_theHttpConnection=null)};sls.set_connection_callbacks=function(c){null!==_sls_theHttpConnection&&(_sls_theHttpConnection.callbacks=c)};
sls.request_record=function(c){return null===c?sls.ReturnCode.UndefinedOrNullParam:null!==_sls_theHttpConnection?_sls_theHttpConnection.request_record(c):sls.ReturnCode.NoConnection};sls.unmonitor_fields=function(c){return null===c?sls.ReturnCode.UndefinedOrNullParam:null!==_sls_theHttpConnection?_sls_theHttpConnection.unmonitor_fields(c):sls.ReturnCode.NoConnection};
sls.unmonitor_record=function(c){return null===c?sls.ReturnCode.UndefinedOrNullParam:null!==_sls_theHttpConnection?_sls_theHttpConnection.unmonitor_record(c):sls.ReturnCode.NoConnection};sls.insert_request=function(c){return null===c?sls.ReturnCode.UndefinedOrNullParam:null!==_sls_theHttpConnection?_sls_theHttpConnection.insert_request(c):sls.ReturnCode.NoConnection};sls.pause_updates=function(c){return null!==_sls_theHttpConnection?_sls_theHttpConnection.pause_updates(c):sls.ReturnCode.NoConnection};
sls.resume_updates=function(){return null!==_sls_theHttpConnection?_sls_theHttpConnection.resume_updates():sls.ReturnCode.NoConnection};sls.set_max_connection_attempts=function(c){null===_sls_theHttpConnection&&"number"==typeof c&&0<=c&&(sls._maxConnectAttempts=c)};sls.set_insert_timeout=function(c){null===_sls_theHttpConnection&&"number"==typeof c&&5E3<=c&&6E4>=c&&(sls._insertTimeout=c)};
